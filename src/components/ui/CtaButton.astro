---
interface Props {
  section: 'hero' | 'price_offer' | 'final' | 'sticky_bar';
  label: string;
  compact?: boolean;
  class?: string;
}

const { section, label, compact = false, class: className = '' } = Astro.props;

const checkoutUrl = import.meta.env.PUBLIC_CHECKOUT_URL || '#';
const isConfigured = checkoutUrl !== '#';

const sizeClasses = compact
  ? 'px-5 py-3 text-sm min-h-[44px]'
  : 'px-8 py-4 text-base md:text-lg min-h-[56px]';
---

<a
  href={checkoutUrl}
  class={`inline-flex items-center justify-center font-semibold rounded-xl text-white bg-linear-to-br from-primary to-accent-dark shadow-[0_0_20px_rgba(147,51,234,0.3)] hover:from-primary-dark hover:to-[#1d4ed8] hover:shadow-[0_0_30px_rgba(147,51,234,0.5)] hover:scale-[1.02] active:scale-[0.98] active:shadow-none transition-all duration-200 focus:outline-2 focus:outline-offset-2 focus:outline-accent ${sizeClasses} ${className}`}
  data-cta-section={section}
  rel="noopener"
>
  {label}
</a>

{!isConfigured && (
  <script>
    console.warn('[CtaButton] PUBLIC_CHECKOUT_URL is not configured. CTA links will not work.');
  </script>
)}

<script>
  import { buildCheckoutUrl, handleCtaClick } from '../../lib/checkout-url';
  import { captureUTMParams } from '../../lib/tracking';

  // Capture UTMs on page load
  captureUTMParams();

  // Enhance all CTA buttons with dynamic URLs and tracking
  document.querySelectorAll<HTMLAnchorElement>('[data-cta-section]').forEach((el) => {
    const section = el.dataset.ctaSection!;
    const url = buildCheckoutUrl(section);
    if (url !== '#') {
      el.href = url;
    }
    el.addEventListener('click', (e) => {
      if (url === '#') return;
      e.preventDefault();
      handleCtaClick(section, url);
    });
  });
</script>
