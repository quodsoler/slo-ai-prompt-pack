---
interface Props {
  section: 'hero' | 'price_offer' | 'final' | 'sticky_bar';
  label: string;
  compact?: boolean;
  class?: string;
}

const { section, label, compact = false, class: className = '' } = Astro.props;

const sizeClasses = compact
  ? 'px-5 py-3 text-sm min-h-[44px]'
  : 'px-8 py-4 text-base md:text-lg min-h-[56px]';
---

<button
  type="button"
  class={`inline-flex items-center justify-center font-semibold rounded-xl text-white bg-linear-to-br from-primary to-accent-dark shadow-[0_0_20px_rgba(147,51,234,0.3)] hover:from-primary-dark hover:to-[#1d4ed8] hover:shadow-[0_0_30px_rgba(147,51,234,0.5)] hover:scale-[1.02] active:scale-[0.98] active:shadow-none transition-all duration-200 focus:outline-2 focus:outline-offset-2 focus:outline-accent disabled:opacity-60 disabled:cursor-wait ${sizeClasses} ${className}`}
  data-cta-section={section}
  data-cta-label={label}
>
  {label}
</button>

<script>
  import { handleCtaClick } from '../../lib/checkout-url';
  import { captureUTMParams } from '../../lib/tracking';

  captureUTMParams();

  document.querySelectorAll<HTMLButtonElement>('[data-cta-section]').forEach((el) => {
    const section = el.dataset.ctaSection!;
    const originalLabel = el.dataset.ctaLabel!;

    el.addEventListener('click', async () => {
      el.disabled = true;
      el.textContent = 'Procesando...';
      try {
        await handleCtaClick(section);
      } finally {
        el.disabled = false;
        el.textContent = originalLabel;
      }
    });
  });
</script>
